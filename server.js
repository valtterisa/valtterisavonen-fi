import N from"http";import i from"fs";import o from"path";import{fileURLToPath as D,pathToFileURL as $}from"url";function h(t){if(typeof t=="string")return t;let d=t.props?Object.entries(t.props).map(([p,s])=>`${p}="${s}"`).join(" "):"",y=t.children?t.children.map(h).join(""):"";return`<${t.type}${d?" "+d:""}>${y}</${t.type}>`}function S(t){let d=D(import.meta.url),y=o.dirname(d),p=process.cwd(),s=t?.pagesDir?o.resolve(t.pagesDir):o.resolve(p,".valzu","pages"),v=t?.publicDir?o.resolve(t.publicDir):o.resolve(p,"public");i.existsSync(s)||(console.error(`\u274C Compiled pages directory not found at ${s}. Please run your build process to compile your pages.`),process.exit(1));let b=i.readdirSync(s).filter(c=>c.endsWith(".js")),f={};b.forEach(c=>{let e=c.replace(/\.js$/,""),a=e==="index"?"/":`/${e}`;f[a]=c});let C=N.createServer(async(c,e)=>{let a=c.url||"/";if(a==="/client.js"){let r=o.resolve(p,".valzu","client.js");i.readFile(r,(n,m)=>{n?(e.statusCode=404,e.end("Not Found")):(e.setHeader("Content-Type","application/javascript"),e.end(m))});return}let u=o.resolve(v,"."+a);if(i.existsSync(u)&&i.statSync(u).isFile()){let r="text/plain",n=o.extname(u);n===".html"?r="text/html":n===".css"?r="text/css":n===".js"&&(r="application/javascript"),i.readFile(u,(m,w)=>{m?(e.statusCode=500,e.end("Internal Server Error")):(e.setHeader("Content-Type",r),e.end(w))});return}if(f[a]!==void 0){try{let r=f[a],n=o.join(s,r),x=(await import($(n).href)).default;if(!x)throw new Error(`Component not found in ${r}`);let T=await x(),j=h(T),E=o.resolve(v,"index.html"),l=i.readFileSync(E,"utf8");l=l.replace('<div id="app"></div>',`<div id="app">${j}</div>`),l=l.replace("</body>",'<script type="module" src="/client.js"><\/script></body>'),e.setHeader("Content-Type","text/html"),e.end(l)}catch(r){console.error("\u274C Error rendering route:",r),e.statusCode=500,e.end("Internal Server Error")}return}e.statusCode=404,e.end("Not Found")}),g=t?.port||Number(process.env.PORT)||3e3;C.listen(g,()=>{console.log(`\u2705 Production server running on http://localhost:${g}`)})}S();
